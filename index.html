<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - InfoTech</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #f1f5f9;
      position: relative;
      overflow: hidden;
    }

    /* Animated background particles */
    body::before {
      content: '';
      position: absolute;
      width: 400px;
      height: 400px;
      background: radial-gradient(circle, rgba(56,189,248,0.15) 0%, transparent 70%);
      border-radius: 50%;
      top: -200px;
      right: -200px;
      animation: float 20s infinite ease-in-out;
    }

    body::after {
      content: '';
      position: absolute;
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, rgba(56,189,248,0.1) 0%, transparent 70%);
      border-radius: 50%;
      bottom: -150px;
      left: -150px;
      animation: float 15s infinite ease-in-out reverse;
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(50px, 50px); }
    }

    /* Language switch button */
    .lang-switch {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(30,41,59,0.8);
      backdrop-filter: blur(10px);
      color: #cbd5e1;
      border: 1px solid rgba(56,189,248,0.3);
      border-radius: 24px;
      padding: 10px 18px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .lang-switch:hover {
      background: rgba(56,189,248,0.15);
      border-color: #38bdf8;
      color: #38bdf8;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(56,189,248,0.2);
    }

    .lang-switch span {
      font-size: 16px;
    }

    /* Login container */
    .login-container {
      background: rgba(30,41,59,0.6);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 24px;
      padding: 48px 40px;
      width: 100%;
      max-width: 440px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      position: relative;
      z-index: 10;
      animation: slideUp 0.6s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .login-container h2 {
      font-size: 32px;
      font-weight: 700;
      color: #f1f5f9;
      margin-bottom: 8px;
      text-align: center;
    }

    .subtitle {
      color: #94a3b8;
      font-size: 15px;
      text-align: center;
      margin-bottom: 32px;
    }

    /* Form styles */
    form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    input[type="text"],
    input[type="password"] {
      width: 100%;
      padding: 14px 16px;
      background: rgba(15,23,42,0.6);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      color: #f1f5f9;
      font-size: 15px;
      transition: all 0.3s ease;
    }

    input[type="text"]:focus,
    input[type="password"]:focus {
      outline: none;
      border-color: #38bdf8;
      background: rgba(15,23,42,0.8);
      box-shadow: 0 0 0 3px rgba(56,189,248,0.15);
    }

    input::placeholder {
      color: #64748b;
    }

    /* Checkbox */
    label {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      color: #cbd5e1;
      cursor: pointer;
      user-select: none;
    }

    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #38bdf8;
    }

    /* Submit button */
    button[type="submit"] {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%);
      color: #0f172a;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(56,189,248,0.3);
    }

    button[type="submit"]:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(56,189,248,0.4);
    }

    button[type="submit"]:active {
      transform: translateY(0);
    }

    /* Feedback message */
    .feedback {
      display: none;
      color: #f87171;
      background: rgba(239,68,68,0.1);
      border: 1px solid rgba(239,68,68,0.3);
      border-radius: 8px;
      padding: 12px;
      font-size: 13px;
      font-weight: 500;
      text-align: center;
    }

    .feedback.show {
      display: block;
    }

    /* Links */
    .links {
      text-align: center;
      margin-top: 8px;
    }

    .links p {
      font-size: 14px;
      color: #94a3b8;
    }

    .links a {
      color: #38bdf8;
      text-decoration: none;
      transition: color 0.3s;
    }

    .links a:hover {
      color: #0ea5e9;
      text-decoration: underline;
    }

    /* InfoTech logo */
    .infotech {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 4px;
      margin-top: 32px;
      font-size: 28px;
      font-weight: 700;
    }

    .info {
      color: #38bdf8;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .tech {
      color: #f1f5f9;
    }

    /* Responsive */
    @media (max-width: 480px) {
      .login-container {
        padding: 32px 24px;
        margin: 20px;
      }

      .login-container h2 {
        font-size: 26px;
      }

      .lang-switch {
        top: 12px;
        right: 12px;
        padding: 8px 14px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <!-- Language switch button -->
  <button class="lang-switch" onclick="toggleLanguage()">
    <span>üåê</span> <span id="langText">PT-BR</span>
  </button>

  <div class="login-container">
    <h2 id="loginTitle" data-i18n="Login">Login</h2>
    <p class="subtitle" id="loginSubtitle" data-i18n="Fa√ßa login para continuar">Fa√ßa login para continuar</p>

    <form id="loginForm" novalidate>
      <input 
        type="text" 
        id="email" 
        placeholder="usuario@gmail.com" 
        required 
        data-i18n-placeholder="usuario@gmail.com"
      >
      
      <input 
        type="password" 
        id="senha" 
        placeholder="********" 
        required 
        data-i18n-placeholder="********"
      >

      <p id="feedback" class="feedback" data-i18n="N√£o foi poss√≠vel encontrar uma conta. Tente novamente ou crie uma conta.">
        N√£o foi poss√≠vel encontrar uma conta. Tente novamente ou crie uma conta.
      </p>

      <label>
        <input type="checkbox" id="keepLogin"> 
        <span data-i18n="Manter login">Manter login</span>
      </label>

      <button type="submit" id="loginButton" data-i18n="Entrar">Entrar</button>

      <div class="links">
        <p>
          <a href="cadastro.html" data-i18n="Crie uma conta">Crie uma conta</a> |
          <a href="forgotPass.html" data-i18n="Esqueceu sua senha?">Esqueceu sua senha?</a>
        </p>
      </div>
    </form>

    <div class="infotech">
      <div class="info"><span>üíª</span><span>INFO</span></div>
      <div class="tech"><span>TECH</span></div>
    </div>
  </div>

  <script>
    // Impede login autom√°tico se vier de logout
    if (localStorage.getItem("forceLogout") === "true") {
      localStorage.clear();
      console.log("Logout detectado ‚Äî sess√£o reiniciada.");
    }

    const form = document.getElementById("loginForm");
    const feedback = document.getElementById("feedback");
    const keepLoginCheckbox = document.getElementById("keepLogin");

    // Carrega automaticamente o usu√°rio salvo
    window.addEventListener("DOMContentLoaded", () => {
      const savedUser = JSON.parse(localStorage.getItem("usuario"));
      const keepLogin = localStorage.getItem("keepLogin");

      // Login autom√°tico se ativado
      if (keepLogin === "true" && savedUser) {
        alert("Login autom√°tico bem-sucedido!");
        window.location.href = "painel.html";
        return;
      }

      // Preenche email salvo
      if (savedUser?.email) {
        document.getElementById("email").value = savedUser.email;
      }
    });

    // Evento de login
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const email = document.getElementById("email").value.trim();
      const senha = document.getElementById("senha").value.trim();
      feedback.classList.remove("show");

      if (!email || !senha) {
        feedback.textContent = "Preencha todos os campos.";
        feedback.classList.add("show");
        return;
      }

      try {
        const response = await fetch("http://localhost:5018/api/Usuarios/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, senha })
        });

        if (response.ok) {
          const data = await response.json();

          const usuarioLogado = {
            id: data.user?.idFunc || data.idFunc || null,
            email: email,
            nome: data.user?.nomeUsuario || data.nomeUsuario || "",
            funcao: data.user?.funcao || data.funcao || ""
          };

          if (!usuarioLogado.id) {
            console.warn("‚ö† Nenhum ID encontrado na resposta do login:", data);
          }

          if (keepLoginCheckbox.checked) {
            localStorage.setItem("usuario", JSON.stringify(usuarioLogado));
            localStorage.setItem("keepLogin", "true");
          } else {
            sessionStorage.setItem("usuario", JSON.stringify(usuarioLogado));
          }

          alert("Login realizado com sucesso!");
          window.location.href = "painel.html";
        } else {
          feedback.textContent = "Usu√°rio ou senha incorretos.";
          feedback.classList.add("show");
        }
      } catch (error) {
        console.error("Erro ao fazer login:", error);
        feedback.textContent = "Falha ao se conectar √† API.";
        feedback.classList.add("show");
      }
    });

    // Sistema de tradu√ß√£o
    let lang = "pt";

    async function translateText(text, targetLang) {
      if (targetLang === "pt") return text;
      const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=pt|${targetLang}`;
      try {
        const response = await fetch(url);
        const data = await response.json();
        return data.responseData.translatedText || text;
      } catch (e) {
        console.error("Erro ao traduzir:", e);
        return text;
      }
    }

    async function translatePage(targetLang) {
      const elements = document.querySelectorAll("[data-i18n]");
      for (const el of elements) {
        const original = el.getAttribute("data-i18n");
        el.textContent = await translateText(original, targetLang);
      }

      const inputs = document.querySelectorAll("[data-i18n-placeholder]");
      for (const input of inputs) {
        const original = input.getAttribute("data-i18n-placeholder");
        input.placeholder = await translateText(original, targetLang);
      }
    }

    function toggleLanguage() {
      const langText = document.getElementById("langText");
      if (lang === "pt") {
        lang = "en";
        langText.textContent = "EN";
      } else {
        lang = "pt";
        langText.textContent = "PT-BR";
      }
      translatePage(lang);
    }
  </script>
</body>
</html>
