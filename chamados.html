<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>InfoTech - Chamados</title>
<style>
  * { box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    min-height: 100vh;
    color: #f1f5f9;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
  }
  .container {
    display: flex;
    min-height: 100vh;
    width: 100vw;
  }
  .sidebar {
    width: 260px;
    background: rgba(30,41,59,0.96);
    backdrop-filter: blur(10px);
    border-right: 1px solid rgba(255,255,255,0.08);
    padding: 32px 20px 20px 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 5;
    position: relative;
  }
  .sidebar h2 {
    font-size: 24px;
    font-weight: bold;
    letter-spacing: 2px;
    color: #38bdf8;
    margin-bottom: 16px;
    text-align: center;
  }
  .sidebar ul { list-style: none; padding: 0; margin: 0; }
  .sidebar ul li { margin: 0 0 12px 0; }
  .sidebar ul li a {
    display: block;
    color: #cbd5e1;
    background: none;
    border-radius: 9px;
    padding: 11px 15px;
    text-decoration: none;
    font-size: 15px;
    font-weight: 500;
    transition: 0.3s all;
  }
  .sidebar ul li a:hover,
  .sidebar ul li a.active {
    background: rgba(56,189,248,0.12);
    color: #38bdf8;
    font-weight: 700;
  }
  .settings {
    margin-top: auto;
    border-top: 1px solid rgba(255,255,255,0.13);
    padding-top: 18px;
  }
  .settings a {
    color: #94a3b8;
    text-decoration: none;
    display: block;
    padding: 10px;
    font-size: 14px;
    transition: color 0.3s;
  }
  .settings a:hover { color: #38bdf8; }
  /* Content */
  .content {
  flex: 1;
  padding: 40px 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 80vh;
}
.main-card, .table-wrapper { /* Use nas duas telas */
  width: 100%;
  max-width: 1040px;
  background: rgba(30,41,59,0.6);
  border-radius: 18px;
  box-shadow: 0 8px 36px rgba(0,0,0,0.22);
  padding: 24px;
  margin: auto;
}

  .content h1 {
    font-size: 2.1rem;
    font-weight: 700;
    color: #f1f5f9;
    margin-bottom: 16px;
    letter-spacing: 1px;
  }
  .actions {
    display: flex;
    gap: 12px;
    margin-bottom: 18px;
    flex-wrap: wrap;
  }
  .actions button {
    padding: 12px 28px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    font-size: 15px;
    box-shadow: 0 2px 10px rgba(56,189,248,0.15);
    background: linear-gradient(90deg, #38bdf8 0%, #0ea5e9 100%);
    color: #0f172a;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .actions button:hover {
    transform: translateY(-2px) scale(1.03);
    background: linear-gradient(90deg, #0ea5e9 0%, #38bdf8 100%);
  }
  .actions .secondary {
    background: linear-gradient(90deg, #22c55e 0%, #166534 100%);
    color: white;
  }
  /* Table/Card area */
  .table-wrapper {
    background: rgba(30,41,59,0.6);
    border-radius: 18px;
    box-shadow: 0 8px 36px rgba(0,0,0,0.22);
    padding: 24px;
    overflow-x: auto;
    overflow-y: auto;
    max-height: 65vh;
    margin-bottom: 20px;
    min-width: 340px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 15px;
    min-width: 680px;
  }
  th, td {
    padding: 10px 9px;
    text-align: center;
  }
  th {
    color: #3b82f6;
    text-transform: uppercase;
    background: rgba(255,255,255,0.05);
    font-weight: 700;
    font-size: 13.5px;
    border-bottom: 2px solid rgba(56,189,248,0.15);
    letter-spacing: 0.5px;
  }
  tbody tr {
    border-bottom: 1px solid rgba(255,255,255,0.07);
    transition: background 0.18s;
  }
  tbody tr:hover { background: rgba(56,189,248,0.05);}
  .status-aberto  { color: #f87171; font-weight: 700;}
  .status-finalizado, .status-concluido { color: #4ade80; font-weight: 700;}
  .status-em { color: #fbbf24; font-weight: 700;}
  .priority-alta { color: #f87171; font-weight: 700;}
  .priority-media { color: #fbbf24; font-weight: 700;}
  .priority-baixa { color: #4ade80; font-weight: 700;}
  /* Modal */
  .modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0; top: 0;
    width: 100vw; height: 100vh;
    background-color: rgba(0,0,0,0.75);
    align-items: center;
    justify-content: center;
  }
  .modal-content {
    background: rgba(30,41,59,0.98);
    border-radius: 20px;
    box-shadow: 0 0 40px rgba(56,189,248,0.21);
    padding: 38px 30px 22px 30px;
    width: 100%;
    max-width: 410px;
    color: #f1f5f9;
    position: relative;
    animation: slideUp 0.4s;
    overflow-y: auto;
  }
  .modal-content h2 {
    font-size: 22px; color: #38bdf8; margin: 0 0 16px 0; text-align: center;
  }
  .modal-content label {
    display: block; margin-top: 14px; margin-bottom: 6px;
    color: #e0f2fe;
    font-size: 14.3px; font-weight: 600;
  }
  .modal-content input, .modal-content select, .modal-content textarea {
    width: 100%; padding: 11px;
    margin-bottom: 7px; border: none; border-radius: 10px;
    font-size: 15px; background: rgba(241,245,249,0.91); color: #273549;
    transition: box-shadow 0.2s, background 0.2s;
  }
  .modal-content input:focus, .modal-content textarea:focus, .modal-content select:focus { outline: 2px solid #38bdf8; }
  .modal-content textarea { resize: vertical; min-height: 66px;}
  .modal-content .btn-save, .modal-content .btn-close {
    margin-top: 15px;
    padding: 12px; border: none; border-radius: 9px;
    cursor: pointer;
    font-weight: bold;
    font-size: 15.5px;
    width: 100%;
    transition: 0.2s;
    background: linear-gradient(90deg, #22c55e 0%, #166534 100%);
    color: #fff;
    box-shadow: 0 2px 12px rgba(34,197,94,0.12);
  }
  .modal-content .btn-close {
    background: linear-gradient(90deg, #f87171 0%, #ef4444 100%);
    margin-top: 7px;
  }
  .modal-content .btn-save:hover { background: #16e049;}
  .modal-content .btn-close:hover { background: #ef4444;}
  .close {
    position: absolute;
    top: 16px;
    right: 23px;
    font-size: 24px;
    cursor: pointer;
    color: #64748b;
    font-weight: bold;
  }
  /* Scroll bar styling */
  .table-wrapper::-webkit-scrollbar { width: 9px; height: 10px; }
  .table-wrapper::-webkit-scrollbar-thumb { background: #38bdf8; border-radius: 7px;}
  .table-wrapper::-webkit-scrollbar-track { background: rgba(255,255,255,0.1);}
  .table-wrapper { scrollbar-width: thin; scrollbar-color: #38bdf8 rgba(255,255,255,0.1);}
  /* Responsive */
  @media (max-width: 900px) {
    .container { flex-direction: column; }
    .sidebar { flex-direction: row; width: 100%; padding: 16px 4vw;}
    .sidebar ul { display:flex; gap: 10px;}
  }
  @media (max-width: 600px) {
    .content { padding: 20px 7px;}
    .sidebar { font-size: 13.5px;}
    .modal-content {padding: 22px 7vw;}
  }
</style>
</head>
<body>
<div class="container">
  <!-- Sidebar -->
  <div class="sidebar">
    <h2>INFOTECH</h2>
    <ul>
      <li><a href="painel.html">Painel Dashboard</a></li>
      <li><a href="chamados.html" class="active">Chamados</a></li>
      <li><a href="relatorio.html">Relat√≥rios</a></li>
      <li><a href="tecnico.html">T√©cnicos</a></li>
      <li><a href="#">Ajuda</a></li>
    </ul>
    <div class="settings">
      <a href="#" onclick="toggleLanguage()">üåê <span data-i18n="Mudar idioma">Mudar idioma</span></a>
      <a href="index.html" data-i18n="Encerrar sess√£o">Encerrar sess√£o</a>
    </div>
  </div>
  <!-- Main Content -->
  <div class="content">
    <h1 data-i18n="Chamados">Chamados</h1>
    <div class="actions">
      <button onclick="openModal()" data-i18n="Novo chamado">Novo chamado</button>
      <button class="secondary" onclick="carregarChamados()" data-i18n="Atualizar">Atualizar</button>
    </div>
    <div class="table-wrapper">
      <table id="chamadosTable">
        <thead>
          <tr>
            <th data-i18n="ID">ID</th>
            <th data-i18n="T√≠tulo">T√≠tulo</th>
            <th data-i18n="Descri√ß√£o">Descri√ß√£o</th>
            <th data-i18n="Status">Status</th>
            <th data-i18n="Data">Data</th>
            <th data-i18n="Prioridade">Prioridade</th>
          </tr>
        </thead>
        <tbody><!-- dados por JS --></tbody>
      </table>
    </div>
  </div>
</div>
<!-- Modal para novo chamado -->
<div id="chamadoModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2 data-i18n="Novo Chamado">Novo Chamado</h2>
    <label data-i18n="T√≠tulo">T√≠tulo *</label>
    <input type="text" id="titulo" maxlength="150" placeholder="T√≠tulo do chamado" required>
    <label data-i18n="Descri√ß√£o">Descri√ß√£o *</label>
    <textarea id="descricao" rows="4" placeholder="Descreva o problema..." required></textarea>
    <label data-i18n="Prioridade">Prioridade *</label>
    <select id="prioridade">
      <option value="Baixa">Baixa</option>
      <option value="M√©dia" selected>M√©dia</option>
      <option value="Alta">Alta</option>
    </select>
    <label data-i18n="Status">Status *</label>
    <select id="status">
      <option value="Aberto" selected>Aberto</option>
      <option value="Em andamento">Em andamento</option>
      <option value="Recebido">Recebido</option>
      <option value="Finalizado">Finalizado</option>
    </select>
    <button class="btn-save" onclick="addChamado()">Salvar</button>
    <button class="btn-close" onclick="closeModal()">Cancelar</button>
  </div>
</div>
<script>
  // Carregar e renderizar chamados da API
  async function carregarChamados() {
    try {
      const response = await fetch('http://localhost:5018/api/chamados');
      if (!response.ok) throw new Error('Erro ao buscar chamados');
      const chamados = await response.json();
      const tbody = document.getElementById("chamadosTable").querySelector("tbody");
      tbody.innerHTML = '';
      chamados.forEach(chamado => {
        const data = new Date(chamado.dataAbertura).toLocaleDateString("pt-BR");
        let st = chamado.status.toLowerCase();
        let pc = chamado.prioridade.toLowerCase();
        const statusClass = st.includes('aberto') ? 'status-aberto'
            : (st.includes('finaliz') || st.includes('conclu')) ? 'status-finalizado' : (st.includes('andamento') ? 'status-em' : '');
        const prioClass = pc.includes('alt') ? 'priority-alta' : (pc.includes('m√©')||pc.includes('med')) ? 'priority-media' : 'priority-baixa';
        tbody.innerHTML += `<tr>
          <td>${chamado.idChamado}</td>
          <td>${chamado.titulo}</td>
          <td>${chamado.descricao}</td>
          <td class="${statusClass}">${chamado.status}</td>
          <td>${data}</td>
          <td class="${prioClass}">${chamado.prioridade}</td>
        </tr>`;
      });
    } catch (error) {
      console.error('Erro ao carregar chamados:', error);
      alert('N√£o foi poss√≠vel carregar os chamados. Verifique se a API est√° rodando.');
    }
  }
  window.addEventListener('DOMContentLoaded', carregarChamados);
  // Modal controls
  function openModal() { document.getElementById("chamadoModal").style.display = "flex"; }
  function closeModal() { document.getElementById("chamadoModal").style.display = "none"; }
  // Cadastro de chamado
  async function addChamado() {
    const titulo = document.getElementById("titulo").value;
    const descricao = document.getElementById("descricao").value;
    const prioridade = document.getElementById("prioridade").value;
    const status = document.getElementById("status").value;
    if (!titulo || !descricao) { alert("Preencha todos os campos!"); return;}
    const novoChamado = {
      titulo, descricao, prioridade, status,
      dataAbertura: new Date().toISOString()
    };
    try {
      const response = await fetch('http://localhost:5018/api/chamados', {
        method: 'POST', headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(novoChamado)
      });
      if (!response.ok) throw new Error('Erro ao criar chamado');
      alert('Chamado criado com sucesso!');
      closeModal();
      document.getElementById("titulo").value = '';
      document.getElementById("descricao").value = '';
      carregarChamados();
    } catch (error) {
      console.error('Erro ao criar chamado:', error);
      alert('Erro ao criar chamado. Verifique a API.');
    }
  }
  // Tradu√ß√£o din√¢mica (igual ao padr√£o das outras telas)
  let lang = "pt";
  async function translateText(text, targetLang) {
    if (targetLang === "pt") return text;
    const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=pt|${targetLang}`;
    try {
      const response = await fetch(url);
      const data = await response.json();
      return data.responseData.translatedText || text;
    } catch { return text; }
  }
  async function translatePage(targetLang) {
    const elements = document.querySelectorAll("[data-i18n]");
    for (const el of elements) {
      const original = el.getAttribute("data-i18n");
      el.textContent = await translateText(original, targetLang);
    }
    const inputs = document.querySelectorAll("[data-i18n-placeholder]");
    for (const input of inputs) {
      const original = input.getAttribute("data-i18n-placeholder");
      input.placeholder = await translateText(original, targetLang);
    }
  }
  function toggleLanguage() {
    lang = lang === "pt" ? "en" : "pt";
    translatePage(lang);
  }
</script>
</body>
</html>
